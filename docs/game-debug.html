<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game Debug</title>
</head>
<body>
    <h1>Game Debug Test</h1>
    <div id="log"></div>
    
    <script>
        const log = (msg) => {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('log').appendChild(div);
            console.log(msg);
        };
        
        // Capture errors
        window.onerror = (msg, url, line, col, error) => {
            log(`ERROR: ${msg} at ${url}:${line}:${col}`);
            if (error && error.stack) {
                log(`Stack: ${error.stack}`);
            }
            return false;
        };
        
        log('Starting debug test...');
        log(`Document ready state: ${document.readyState}`);
    </script>
    
    <!-- Import modular entry as module -->
    <script type="module">
        import('./js/main_eventbus_pure.js').then(() => {
            const log = (msg) => {
                const div = document.createElement('div');
                div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
                document.getElementById('log').appendChild(div);
            };
            
            log('✅ main_eventbus_pure.js loaded successfully');
            
            // Check what was created
            setTimeout(() => {
                const dbg = window.refactorDebug;
                log(`eventBus present: ${!!dbg?.eventBus}`);
                log(`stateManager present: ${!!dbg?.stateManager}`);
            }, 1000);
        }).catch(error => {
            const log = (msg) => {
                const div = document.createElement('div');
                div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
                div.style.color = 'red';
                document.getElementById('log').appendChild(div);
            };
            
            log(`❌ Failed to load main_eventbus_pure.js: ${error.message}`);
            log(`Stack: ${error.stack}`);
        });
    </script>
</body>
</html>
