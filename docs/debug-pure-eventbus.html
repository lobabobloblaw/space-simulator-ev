<!DOCTYPE html>
<html>
<head>
    <title>Pure EventBus Debug</title>
    <link rel="stylesheet" href="./css/main.css">
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <!-- All required elements for the game -->
    <div id="gameHUD"></div>
    <div id="tutorialHint"></div>
    <div id="landingOverlay">
        <div id="landingInfo"></div>
        <div id="tradingPanel"></div>
        <div id="shopPanel"></div>
        <div id="commodityList"></div>
    </div>
    <canvas id="minimapCanvas" width="100" height="100"></canvas>
    
    <div id="debug" style="position:fixed; top:0; left:0; background:black; color:lime; padding:10px; font-family:monospace; z-index:9999; max-width:600px; max-height:400px; overflow:auto;">
        <h3>Pure EventBus Debug</h3>
        <div id="debugLog"></div>
    </div>
    
    <script type="module">
        const log = (msg, type = 'info') => {
            const debugLog = document.getElementById('debugLog');
            const entry = document.createElement('div');
            entry.style.color = type === 'error' ? 'red' : type === 'warn' ? 'yellow' : 'lime';
            entry.textContent = `[${type.toUpperCase()}] ${msg}`;
            debugLog.appendChild(entry);
            console.log(msg);
        };
        
        window.addEventListener('error', (e) => {
            log(`Error: ${e.message} at ${e.filename}:${e.lineno}:${e.colno}`, 'error');
            if (e.error) {
                log(`Stack: ${e.error.stack}`, 'error');
            }
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            log(`Unhandled promise rejection: ${e.reason}`, 'error');
        });
        
        log('Starting import of main_eventbus_pure.js...');
        
        import('./js/main_eventbus_pure.js')
            .then(module => {
                log('✓ main_eventbus_pure.js imported successfully');
                log(`Module exports: ${Object.keys(module).join(', ')}`);
                
                // Check what was initialized
                setTimeout(() => {
                    log(`window.eventBus: ${window.eventBus ? 'exists' : 'missing'}`);
                    log(`window.stateManager: ${window.stateManager ? 'exists' : 'missing'}`);
                    log(`window.systems: ${window.systems ? 'exists' : 'missing'}`);
                    
                    // Check for bad globals
                    log(`window.ship (should be undefined): ${window.ship ? 'BAD - exists' : 'GOOD - undefined'}`);
                    log(`window.planets (should be undefined): ${window.planets ? 'BAD - exists' : 'GOOD - undefined'}`);
                    
                    // Check state
                    if (window.stateManager) {
                        const state = window.stateManager.state;
                        log(`State ship: ${state.ship ? 'exists' : 'missing'}`);
                        log(`State planets: ${state.planets ? state.planets.length : 'missing'}`);
                    }
                }, 2000);
            })
            .catch(error => {
                log(`✗ Failed to import: ${error.message}`, 'error');
                log(`Stack trace: ${error.stack}`, 'error');
            });
    </script>
</body>
</html>